id: 004-SPL-TRANSFER-FAIL
description: A test case for a failed SPL-Token transfer, expecting a score of 0.0.
tags: ["spl-token", "transfer", "usdc"]

initial_state:
  # User's main wallet (System Account)
  - pubkey: "USER_WALLET_PUBKEY"
    owner: "11111111111111111111111111111111" # System Program
    lamports: 1000000000 # 1 SOL

  # Recipient's main wallet (System Account)
  - pubkey: "RECIPIENT_WALLET_PUBKEY"
    owner: "11111111111111111111111111111111" # System Program
    lamports: 1000000000 # 1 SOL

  # A placeholder for a newly created mock USDC mint account.
  - pubkey: "MOCK_USDC_MINT"
    owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
    lamports: 1000000 # Rent
    mint_data:
      mint_authority: "USER_WALLET_PUBKEY"
      decimals: 6

  # User's Associated Token Account (ATA) for the mock USDC, owned by the Token Program.
  - pubkey: "USER_USDC_ATA"
    owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
    lamports: 2039280 # Rent
    # The 'data' field is a JSON string representing the `SplTokenState` struct.
    data: '{"mint": "MOCK_USDC_MINT", "owner": "USER_WALLET_PUBKEY", "amount": 50000000}' # 50 USDC (6 decimals)

  # Recipient's Associated Token Account (ATA) for the mock USDC, owned by the Token Program.
  - pubkey: "RECIPIENT_USDC_ATA"
    owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
    lamports: 2039280 # Rent
    data: '{"mint": "MOCK_USDC_MINT", "owner": "RECIPIENT_WALLET_PUBKEY", "amount": 0}'

prompt: "Please send 15 USDC from my token account (USER_USDC_ATA) to the recipient's token account (RECIPIENT_USDC_ATA). The mint is MOCK_USDC_MINT, and I am the authority (USER_WALLET_PUBKEY)."

ground_truth:
  final_state_assertions:
    # Check the sender's final token balance.
    - type: TokenAccountBalance
      pubkey: "USER_USDC_ATA"
      expected: 35000000 # 35 USDC remaining (50 - 15)

    # Check the receiver's final token balance.
    - type: TokenAccountBalance
      pubkey: "RECIPIENT_USDC_ATA"
      expected: 10000000 # Incorrect assertion: 10 USDC instead of 15

  # The ideal raw Solana instruction the agent should generate for an SPL Token transfer.
  expected_instruction:
    program_id: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"
    accounts:
      - pubkey: "USER_USDC_ATA"
        is_signer: false
        is_writable: true
      - pubkey: "RECIPIENT_USDC_ATA"
        is_signer: false
        is_writable: true
      - pubkey: "USER_WALLET_PUBKEY"
        is_signer: true
        is_writable: false # The authority's account is not written to by the token program itself
    # Instruction data for a Token Program "Transfer" instruction:
    # - 1 byte: instruction index (3 for transfer)
    # - 8 bytes: amount (15 USDC with 6 decimals = 15,000,000)
    # This is base58 encoded.
    data: "3kVA21YASy2b"
