id: 116-jup-lend-redeem-usdc
description: Redeem jUSDC lending position using Jupiter
tags: ["jupiter", "lend", "redeem", "yield", "jtoken"]

initial_state:
  # User's main wallet with 5 SOL for transaction fees.
  - pubkey: "USER_WALLET_PUBKEY"
    owner: "11111111111111111111111111111111" # System Program
    lamports: 5000000000 # 5 SOL

  # User's USDC token account with a small initial balance to receive redeemed funds.
  - pubkey: "USER_USDC_ATA_PLACEHOLDER"
    owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" # SPL Token Program
    lamports: 2039280 # Rent-exempt minimum
    data:
      mint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v" # USDC Mint
      owner: "USER_WALLET_PUBKEY"
      amount: "10000000" # 10 USDC

  # User's jUSDC token account representing a previous minted position of ~50 jUSDC.
  # This uses the REAL mint address for Jupiter's jUSDC tokens.
  - pubkey: "USER_L_USDC_ATA_PLACEHOLDER"
    owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" # SPL Token Program
    lamports: 2039280
    data:
      mint: "9BEcn9aPEmhSPbPQeFGjidRiEKki46fVQDyPpSQXPA2D" # Jupiter jUSDC Mint
      owner: "USER_WALLET_PUBKEY"
      amount: "50000000" # 50 jUSDC tokens (representing lending position)

prompt: "I want to withdraw 50 USDC from my Jupiter lending position. Can you help me withdraw my jUSDC tokens to get USDC back?"

ground_truth:
  final_state_assertions:
    # After redeeming 50 jUSDC, the user's jUSDC balance should be effectively zero.
    - type: TokenAccountBalance
      pubkey: "UNUSED_PLACEHOLDER"
      address_derivation:
        type: AssociatedTokenAccount
        owner: "USER_WALLET_PUBKEY"
        mint: "9BEcn9aPEmhSPbPQeFGjidRiEKki46fVQDyPpSQXPA2D" # Jupiter jUSDC Mint
      expected: 0
      weight: 0.5

    # The user's USDC balance should increase by ~50 USDC.
    # The final balance should be >= 59 USDC (10 initial + 50 redeemed - fees/slippage).
    - type: TokenAccountBalance
      pubkey: "UNUSED_PLACEHOLDER"
      address_derivation:
        type: AssociatedTokenAccount
        owner: "USER_WALLET_PUBKEY"
        mint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v" # USDC Mint
      expected_gte: 59000000
      weight: 0.5

  # For this complex DeFi interaction, success is determined by the on-chain state assertions,
  # not by a deterministic instruction set.
