id: 112-JUP-LEND-WITHDRAW-SOL
description: A benchmark to test withdrawing native SOL from Jupiter's unified lend feature.
tags: ["jupiter", "lend", "withdraw", "sol", "surfpool"]

initial_state:
  # User's main wallet with 1 SOL for fees. The rest of the SOL is "lent".
  - pubkey: "USER_WALLET_PUBKEY"
    owner: "11111111111111111111111111111111" # System Program
    lamports: 1000000000 # 1 SOL

  # User's Associated Token Account (ATA) for the SOL L-Token.
  # This account must be pre-funded to simulate a prior deposit.
  # The amount here represents roughly 0.1 SOL deposited. The exact L-token amount is non-deterministic,
  # so we'll use a representative value. The test runner will set this balance.
  - pubkey: "USER_JSOL_ATA"
    owner: "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA" # Token Program
    lamports: 2039280 # Rent
    data:
      mint: "JSo11111111111111111111111111111111111111111" # Jupiter SOL L-Token
      owner: "USER_WALLET_PUBKEY"
      amount: "100000000" # Represents ~0.1 SOL worth of L-tokens

prompt: "Using Jupiter, withdraw my 0.1 SOL. My wallet is USER_WALLET_PUBKEY."

ground_truth:
  final_state_assertions:
    # The user's SOL balance should increase by approximately 0.1 SOL.
    # We check for a change greater than a slightly lower amount to account for fees/oracle differences.
    - type: SolBalanceChange
      pubkey: "USER_WALLET_PUBKEY"
      expected_change_gte: 99995000 # ~0.1 SOL minus fees

    # The user's L-Token balance should be zero after withdrawing everything.
    - type: TokenAccountBalance
      pubkey: "USER_JSOL_ATA"
      expected: 0

  # The agent is expected to return a transaction for the lend withdrawal operation.
  expected_instructions:
    - program_id: "JUPENDy1xcS4346g2pPpcDciLpMSpYkiv2BfWSaC9Gv" # Jupiter Lend Program
      accounts:
        - pubkey: "USER_WALLET_PUBKEY" # User's wallet, the authority
          is_signer: true
          is_writable: true
        - pubkey: "USER_JSOL_ATA" # User's source L-Token ATA
          is_signer: false
          is_writable: true
      data: "..." # Placeholder
